C51 COMPILER V9.52.0.0   CHENGXU                                                           10/09/2015 15:50:35 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE CHENGXU
OBJECT MODULE PLACED IN chengxu.OBJ
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE chengxu.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /********************************************************************
   2                                      汇诚科技
   3          
   4          实现功能:按键触发延时1分钟程序
   5          使用芯片：STC15F104E
   6          晶振：12MHZ
   7          波特率：9600
   8          编译环境：Keil
   9          作者：zhangxinchunleo
  10          网站：www.ourhc.cn
  11          淘宝店：汇诚科技 http://shop36330473.taobao.com
  12          【声明】此程序仅用于学习与参考，引用请注明版权和作者信息！     
  13          
  14          *********************************************************************/
  15          /********************************************************************/
  16          
  17          #include<reg52.h>          //库文件
  18          #define uchar unsigned char//宏定义无符号字符型
  19          #define uint unsigned int  //宏定义无符号整型
  20          /********************************************************************
  21                                      初始定义
  22          *********************************************************************/
  23          uint sec; //定义计数值，每过1/10 秒，sec 加一
  24          uint minu; //1分钟加1次
  25          uchar keycnt=0;//按下次数值
  26          uint tcnt; //键值判断
  27          uint time; //eeprom 内的时间1-1440，分钟
  28          /********************************************************************
  29                                      I/O定义
  30          *********************************************************************/
  31          sbit P33=P3^3;   //定义单片机P3口的第3位 （即P3.3）
  32          sbit P3_5=P3^5;
  33          /********************************************************************
  34                                      延时函数
  35          *********************************************************************/
  36          void delay(uchar t)
  37          {
  38   1        uchar i,j;
  39   1         for(i=0;i<t;i++)
  40   1         {
  41   2           for(j=13;j>0;j--);
  42   2         { 
  43   3           ;
  44   3         }
  45   2         }
  46   1      }
  47          
  48          /********************************************************************
  49                                      按键扫描函数(改成上位机低电平触发)
  50          *********************************************************************/
  51          void KEY() //按键扫描程序
  52          {
  53   1      if(P3_5==0)
  54   1        {
  55   2        delay(20);
C51 COMPILER V9.52.0.0   CHENGXU                                                           10/09/2015 15:50:35 PAGE 2   

  56   2        if(P3_5==0)
  57   2        {
  58   3        TH0=0x06; //对TH0 TL0 赋值
  59   3        TL0=0x06;
  60   3        P33=1;
  61   3        TR0=1; //开始定时
  62   3      
  63   3        }
  64   2      }}
  65          /********************************************************************
  66                                      定时中断服务函数
  67          *********************************************************************/
  68          void t0(void) interrupt 1 using 0 //定时中断服务函数
  69          {
  70   1        tcnt++; //每过250ust tcnt 加一
  71   1        if(tcnt==3660) //计满4000 次（1 秒）时
  72   1        {
  73   2          tcnt=0; //重新再计
  74   2          sec++;
  75   2      
  76   2          if(sec==60) //定时10 秒，在从零开始计时
  77   2          {
  78   3            sec=0;
  79   3            minu++;
  80   3            if(minu ==time)
  81   3            {
  82   4              minu=0;
  83   4              P33=0;
  84   4              TR0=0;
  85   4            }
  86   3           
  87   3          }
  88   2        }
  89   1      }
  90          
  91          /********************************************************************
  92                                      主函数
  93          *********************************************************************/
  94          void main()
  95          {
  96   1        time = 1;
  97   1        TMOD=0x02; //定时器工作在方式2
  98   1        ET0=1;
  99   1        EA=1;
 100   1        sec=0;
 101   1        minu = 0;
 102   1        TR0=0;
 103   1        P33=0;
 104   1        while(1)
 105   1        {
 106   2         KEY();
 107   2        }
 108   1      }   
 109          
 110            
 111          /********************************************************************
 112                                        结束
 113          *********************************************************************/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    143    ----
C51 COMPILER V9.52.0.0   CHENGXU                                                           10/09/2015 15:50:35 PAGE 3   

   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
